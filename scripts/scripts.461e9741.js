$(document).ready(function(){$("body").on("click",".navbar-collapse a",function(){var a=$(this);a.closest(".navbar-collapse").collapse("hide")})}),angular.module("webStorage",["logs"]).factory("webStorage",["logs",function(a){var b={set:function(a,b){localStorage.setItem(a,JSON.stringify(b))},get:function(a){var b=localStorage.getItem(a);if(void 0==b||null==b)return null;var c=null;try{c=JSON.parse(b)}catch(d){}return c},clearAll:function(){localStorage.clear()},getQty:function(){var a=0;return angular.forEach(localStorage,function(b){a+=b.length}),a}};return b}]),angular.module("synchro",["webStorage","logs"]).factory("synchro",["webStorage","$q","logs",function(a,b,c){var d={listeSynchro:[],config:null,dateSynchro:function(){return Date.now()/1e3|0},setConfig:function(a){this.config=a},isStorageEnable:function(){return this.isActive()&&1==this.config.synchro.storageEnable&&"string"==typeof this.config.synchro.storageType},init:function(a){var b=this;"undefined"!=typeof a&&(b.config=a),b.isActive()&&angular.forEach(b.config.synchro.links,function(a){var c=null;if(null==c){var d=a.callback(a);if(b.listeSynchro[a.name]=d,b.isStorageEnable()&&void 0!=d&&(void 0==a.specificStorage||1!=a.specificStorage)){b.storageSet(a.name,d,!0);var e=b.dateSynchro();b.setConf("lastSynchro",e),void 0!=a.setTimeSynchro&&0!=a.setTimeSynchro&&(b.timeSynchro=a.setTimeSynchro)}}})},storageSet:function(b,c,d){"undefined"==typeof d&&(d=!0);switch(this.config.synchro.storageType){case"W":d?c.then(function(c){a.set(b,c)}):a.set(b,c);break;case"P":}},storageGet:function(b){var c=this;switch(c.config.synchro.storageType){case"W":return a.get(b);case"P":}},storageClearAll:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.clearAll();case"P":}},storageQty:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.getQty();case"P":}},isActive:function(){return null==this.config||"undefined"==typeof this.config.synchro||"undefined"==typeof this.config.synchro.enabled||1!=this.config.synchro.enabled||"undefined"==typeof this.config.synchro.links||0==this.config.synchro.links.length?!1:!0},getConf:function(a){if(this.isStorageEnable()){var b=this.storageGet("conf_"+a);return b}},get:function(a,b){var c=this;if("undefined"!=typeof c.listeSynchro[a]&&null!=c.listeSynchro[a])return c.listeSynchro[a];if(c.isStorageEnable()){var d=c.storageGet(a);if("undefined"!=typeof d&&null!=d){void 0!=b&&void 0!=d[b]&&(d=d[b].obj);var e=c.getPromise(d);return c.listeSynchro[a]=e,e}}return null},getPromise:function(a){var c=b.defer();return c.resolve(a),c.promise},setConf:function(a,b){if(this.isStorageEnable()){this.storageSet("conf_"+a,b,!1)}},set:function(a,b,c){var d,e;if(void 0!=c){void 0==c.promise?(d=this.getPromise(c),e=c):(d=c.promise,e=c.obj),void 0==this.listeSynchro[a]&&(this.listeSynchro[a]=[]),this.listeSynchro[a][b]=d;var f=this.storageGet(a);null==f&&(f=[]),void 0==f&&(f=[]),f[b]=e,this.storageSet(a,f,!1)}else void 0==b.promise?(d=this.getPromise(b),e=b):(d=b.promise,e=b.obj),this.listeSynchro[a]=d,this.storageSet(a,e,!1)},clearAll:function(){this.storageClearAll(),this.listeSynchro=[]},getStockageQty:function(){var a={stockage:"NC",memoire:"NC"};return this.isStorageEnable()||(a.stockage=this.storageQty()),this.isActive()||(a.memoire=this.memoryQty()),a},memoryQty:function(){return c.log(window.performance.memory),0},reSync:function(){null!=(login=this.storageGet("login"))?(this.clearAll(),this.storageSet("login",login,!1)):this.clearAll(),this.init(),this.setConf("lastSynchro",this.dateSynchro())},getInfoSynchro:function(){var a=this.getConf("lastSynchro");return a}};return d}]),angular.module("logs",["ngRoute"]).config(["$routeProvider",function(a){console.log("Add logs route"),a.when("/logs",{templateUrl:"views/logs.html",controller:"LogsCtrl"})}]).controller("LogsCtrl",["$scope","logs",function(a,b){a.logs=b}]).factory("logs",function(){var a={active:!0,logList:[],activate:function(){this.log("Logs activated"),this.active=!0},unactivate:function(){this.active=!1,this.log("Logs non activated")},log:function(){var a="Info";"string"==typeof arguments[1]&&-1!=["INFO","WARN","ERROR"].indexOf(arguments[1])&&(a=arguments[1],arguments.splice(1,1));var b="["+a+"] : ";if(console.log(b,arguments),this.active)for(var c=Date.now()/1e3|0,d=0;d<arguments.length;d++)"string"==typeof arguments[d]&&this.logList.push({date:c,type:a,message:arguments[d]})},error:function(a){this.log(a,"ERROR")},info:function(a){this.log(a,"INFO")},warning:function(a){this.log(a,"WARN")}};return a}),angular.module("phonegapModule",[]).factory("baPhoneGap",["logs",function(a){var b={connected:!1,connectFailed:!1,mediaRec:null,config:null,_connection:{state:0,minDebit:!1,label:"No network connection"},setConfig:function(a){this.config=a},isDevice:function(){return"object"==typeof window.cordova?(a.log("C'EST UN DEVICE"),!0):(a.log("CE N'EST PAS UN DEVICE"),!1)},deviceReady:function(b){"object"==typeof window.cordova?(a.log("cordova == object"),document.addEventListener("deviceready",function(){a.log("DANS DEVCEREADY"),b()},!1)):a.log("DAS DE  deviceready")},isIOS:function(){return"IOS"==device.platform},isAndroid:function(){return"Android"==device.platform},isConnected:function(){var b=this,c=b.checkConnection();return b.connectFailed=b.connectFailed||1==b.connected&&0==c.state,b.connected=1==c.state,a.log("Est connecté : ",b.connected),b.connected},checkConnection:function(){var a=this;return this.isDevice()?(this.deviceReady(function(){var b=navigator.network.connection.type,c={};c[Connection.UNKNOWN]={state:1,minDebit:!1,label:"Unknown connection"},c[Connection.ETHERNET]={state:1,minDebit:!0,label:"Ethernet connection"},c[Connection.WIFI]={state:1,minDebit:!0,label:"WiFi connection"},c[Connection.CELL_2G]={state:1,minDebit:!1,label:"Cell 2G connection"},c[Connection.CELL_3G]={state:1,minDebit:!0,label:"Cell 3G connection"},c[Connection.CELL_4G]={state:1,minDebit:!0,label:"Cell 4G connection"},c[Connection.NONE]={state:0,minDebit:!1,label:"No network connection"},a._connection=c[b]}),this._connection):{state:1,label:"WEB connection"}},minDebitToTransfert:function(){var a=this,b=a.checkConnection();return b.minDebit},captureImageFromCamera:function(){var b=this;this.deviceReady(function(){navigator.device.capture.captureImage(function(c){a.log(c),b.loadMedia(c,"#capturedImage"),b.processFile(c[0])},b.errorHandler)})},captureImageProGallery:function(){window.imagePicker.getPictures(function(b){a.log(b);for(var c=0;c<b.length;c++)a.log("Image URI: "+b[c])},function(b){a.log("Error: "+b)})},setMedia:function(a){var b=this;b.mediaRec.play()},litAudio:function(a){var b=this,c="http://192.168.3.103/appli_mobile_chiffrage/app/mpp3.mp3";b.createMedia(c),b.mediaRec.play()},createMedia:function(b){var c=this;c.mediaRec=new Media(b,function(){a.log("Audio() : Audio Success")},function(b){a.log("Audio(): Audio Error : "+b.code)},function(b){a.log("Audio(): Audio Status : ",b)})},captureAudio:function(){this.deviceReady(function(){a.log("Commencement enregistrement");var b=this,c="/BC_IMAGE/testffff.amr";a.log("Creation media"),b.functionLocalDir(),b.createMedia(c),b.mediaRec.startRecord(),setTimeout(function(){b.mediaRec.stopRecord()},5e3)})},processFile:function(a){var b=this;console.log(a.localURL),window.resolveLocalFileSystemURL(a.localURL,b.moveFileToLocalDir,b.resOnError),b.minDebitToTransfert()&&b.tranfert(a)},moveFileToLocalDir:function(a){var b=this,c=new Date,d=c.getTime(),e=d+".jpg",f="BC_IMAGE";window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(c){c.root.getDirectory(f,{create:!0,exclusive:!1},function(b){console.log(b),a.moveTo(b,e,function(){console.log("+++++",arguments)},function(){console.log("ERR+++++",arguments)})},b.errorHandler)},b.errorHandler)},functionLocalDir:function(){var a=this,b=new Date,c=(b.getTime(),"BC_IMAGE");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){b.root.getDirectory(c,{create:!0,exclusive:!1},function(a){console.log(a),fileSystem.root.getFile("testffff.amr",{create:!0},function(){console.log("+333333++++",arguments)},function(){console.log("ERR+++333333++",arguments)})},a.errorHandler)},a.errorHandler)},listRepertory:function(a){var b="BC_IMAGE";void 0!=a&&(b=a),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(a){a.root.getDirectory(b,{create:!1,exclusive:!1},function(a){console.log(a);var b=a.createReader();b.readEntries(function(a){var b;for(b=0;b<a.length;b++)console.log(a[b].name)},function(){console.log("ERR+++++",arguments)})},self.errorHandler)},self.errorHandler)},loadMedia:function(a,b){var c,d,e;for(c=0,e=a.length;e>c;c+=1)d=a[c].fullPath,$(b).attr("src",d)},errorHandler:function(b){a.log("Error : ",b),alert("error"+b)},tranfert:function(b){var c=this;return void a.log(c.config.device.url_upload)},onSuccessFileSystem:function(b){a.log("***test: fileSystem.root.name: ",b);var c="myRecording100.wav",d=b.root.getFile(c,{create:!0,exclusive:!1},function(b){a.log(b),mediaRec=new Media(b.fullPath,function(){a.log("***test: new Media() succeeded ***")},function(b){a.log("***test: new Media() failed ***",b)}),a.log(mediaRec),mediaRec.startRecord(),setTimeout(function(){mediaRec.stopRecord()},1e4)},function(b){a.log("erreur : ",b)});a.log("result ",d)},checkMediaRecFileExist:function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,this.onSuccessFileSystem,null)},onOK_GetFile:function(b){a.log(b);var c="myRecording100.wav";a.log("***test: File "+c+" at "+b.fullPath);var d=b.fullPath;mediaRec=new Media(d,function(){a.log("***test: new Media() succeeded ***")},function(b){a.log("***test: new Media() failed ***",b)}),a.log(mediaRec)},getContact:function(){var b=new ContactFindOptions;b.filter="david",b.multiple=!0;var c=["displayName","name"];navigator.contacts.find(c,function(b){a.log("val",b)},function(b){a.log("err",b)},b)},testDev:function(){var a="cdvfile://localhost/persistent/Pictures/1434619211258.jpg";window.resolveLocalFileSystemURL(a,function(){console.log("+++++",arguments)},function(){console.log("ERR+++++",arguments)})}};return b}]),angular.module("appliMobileBatiChiffrageApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","angular.filter","validation.match","synchro","logs","phonegapModule"]).value("configSite",{profile:{authentificated:!1,UId:""},msgError:!1,synchro:{enabled:!0,links:[],storageEnable:!0,storageType:"W"},UrlBC:"chiffrage.batiactu.com",device:{url_upload:"http://demo.batiactu.info/uploadBC/upload.php"}}).run(["$rootScope","configSite","ProjetsFactory","ClientsFactory","LoginFactory","synchro","logs","baPhoneGap","$interval",function(a,b,c,d,e,f,g,h,i){var j="";"object"==typeof window.cordova&&(j="http://192.168.3.103/appli_mobile_chiffrage/app/"),j="",a.filter={},a.demande_cnx={},a.demande_cnx.flag=!1,a.config=b,a.SynchroStatus={listeProjets:!1,detailProjet:[],detailProjetFourniture:[],detailClient:[],listeClients:!1},b.urlDebug=j,b.synchro.links.push({name:"listeProjets",callback:c.getSynchoListeProjets,checkIfSync:!0,setTimeSynchro:1e3}),b.synchro.links.push({name:"listeDetailProjets",callback:c.getSynchoListeDetailProjets,specificStorage:!0}),b.synchro.links.push({name:"listeClients",callback:d.getSynchoListeClients}),b.is_device=h.isDevice(),h.setConfig(b),f.setConfig(b),f.getStockageQty();var k=f.get("login");null!=k&&k.then(function(a){1==a.hasAbo&&(e.setProfile(a),g.log("LOGIN présent on resynchronise ?"),h.isDevice()?h.isConnected()?(g.log("Appli mobile et connecté on synchronise"),f.reSync()):(g.log("NON CONNECTE on ne synchronisera qu'à prochaine connexion "),i(function(){if(0!=h.connected&&1!=h.connectFailed||!h.isConnected()){var a=h.isConnected();g.log(a?"Connecté":"non Connecté")}else g.log("RESYNCHRO MINUTE"),f.reSync(),h.connectFailed=!1},6e4)):(g.log("Appli Web on synchronise"),f.reSync(),i(function(){g.log("Info minute -- check if connected (fake : Web)")},6e4)))})}]).factory("$exceptionHandler",["baPhoneGap","logs",function(a,b){return function(c,d){c.message+=' (caused by "'+d+'")',b.log("---------------------------------------->Erreur ",c),a.isDevice()&&a.isIOS()&&alert(c),alert(c)}}]).config(["$routeProvider","$sceDelegateProvider",function(a,b){var c="";"object"==typeof window.cordova&&(c="http://192.168.3.103/appli_mobile_chiffrage/app/"),c="",b.resourceUrlWhitelist(["self","http://192.168.3.103/appli_mobile_chiffrage/app/**"]),a.when("/",{templateUrl:c+"views/login.html",controller:"LoginCtrl"}).when("/main",{templateUrl:c+"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:c+"views/about.html",controller:"AboutCtrl"}).when("/myroute",{templateUrl:c+"views/myroute.html",controller:"MyrouteCtrl"}).when("/profil",{templateUrl:c+"views/profil.html",controller:"ProfilCtrl"}).when("/projet/:PrId",{templateUrl:c+"views/projet.html",controller:"ProjetCtrl"}).when("/projets",{templateUrl:c+"views/projets.html",controller:"ProjetsCtrl"}).when("/fournitures/:PrId",{templateUrl:c+"views/fournitures.html",controller:"FournituresCtrl"}).when("/paramprojet/:PrId",{templateUrl:c+"views/paramprojet.html",controller:"ParamprojetCtrl"}).when("/moprojet/:PrId",{templateUrl:"views/moprojet.html",controller:"ParamprojetCtrl"}).when("/clients",{templateUrl:c+"views/clients.html",controller:"ClientsCtrl"}).when("/client/:GCId",{templateUrl:c+"views/client.html",controller:"ClientCtrl"}).when("/chiffrage",{templateUrl:c+"views/chiffrage.html",controller:"ChiffrageCtrl"}).when("/contact",{templateUrl:c+"views/contact.html",controller:"ContactCtrl"}).when("/logout",{templateUrl:c+"views/logout.html",controller:"LogOutCtrl"}).when("/settings",{templateUrl:c+"views/settings.html",controller:"SettingsCtrl"}).when("/device",{templateUrl:c+"views/device.html",controller:"DeviceCtrl"}).when("/code",{templateUrl:c+"views/code.html",controller:"CodeCtrl"}).when("/editions/:PrId",{templateUrl:c+"views/editions.html",controller:"EditionsCtrl"}).when("/gestionClient",{templateUrl:c+"views/gestionClient.html",controller:"GestionClientCtrl"}).when("/gestionClient/:GCId",{templateUrl:c+"views/gestionClient.html",controller:"GestionClientCtrl"}).when("/photos",{templateUrl:c+"views/photos.html",controller:"PhotosCtrl"}).when("/photos/:PrId",{templateUrl:c+"views/photos.html",controller:"PhotosCtrl"}).when("/sons",{templateUrl:c+"views/sons.html",controller:"SonsCtrl"}).when("/sons/:PrId",{templateUrl:c+"views/sons.html",controller:"SonsCtrl"}).when("/notes",{templateUrl:c+"views/notes.html",controller:"NotesCtrl"}).when("/notes/:PrId",{templateUrl:c+"views/notes.html",controller:"NotesCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("appliMobileBatiChiffrageApp").factory("ProjetsFactory",["synchro","configSite","$http","$q","$rootScope","ClientsFactory","baPhoneGap","logs",function(a,b,c,d,e,f,g,h){var i={projectList:!1,nbDetailToSynchronize:5,getSynchoListeProjets:function(a){var e=d.defer(),f="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJETS_FAVORIS_CLIENT&UId="+b.profile.UId+"&order=ORDER+BY+p.dt_maj+DESC%2Cp.dt_cre+DESC%2Cp.id+DESC&filtre_mask_etat=";return c.post(f).success(function(a,b){i.projectList=a,e.resolve(i.projectList)}).error(function(a,b){h.log(a),h.log(b)}),e.promise},getSynchoListeDetailProjets:function(b){var c=a.get("listeProjets");return null==c?null:void c.then(function(a){e.SynchroStatus.listeProjets=!0;var b=i.nbDetailToSynchronize;a.length<i.nbDetailToSynchronize&&(b=a.length);for(var c=0;b>c;c++)i.getSynchoDetailProjets(a[c].PrId)})},getSynchroFourniture:function(f){var g=d.defer(),h="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_LISTE_COMPOS&PrId="+f;c.post(h).success(function(a){g.resolve(a)}),a.set("F-"+f,{promise:g.promise,obj:{}}),g.promise.then(function(b){e.SynchroStatus.detailProjetFourniture["F-"+f]=!0,a.set("F-"+f,{promise:g.promise,obj:b})})},getSynchroDoc:function(f){var g=d.defer(),h="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_DOCUMENT_DEVIS&type=FACT&UId="+b.profile.UId+"&PrId="+f;c.post(h).success(function(a){g.resolve(a)}),a.set("D-"+f,{promise:g.promise,obj:{}}),g.promise.then(function(b){e.SynchroStatus.detailProjetFourniture["D-"+f]=!0,a.set("D-"+f,{promise:g.promise,obj:b})})},getSynchoDetailProjets:function(g){var h=d.defer(),j="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJET&fonction=loadProjet&async=false&PrId="+g;c.post(j).success(function(a,b){h.resolve(a)}),a.set(g,{promise:h.promise,obj:{}}),h.promise.then(function(b){e.SynchroStatus.detailProjet[b.PrId]=!0,a.set(b.PrId,{promise:h.promise,obj:b}),""!=b.GCId&&f.getSynchroClient(b.GCId),i.getSynchroFourniture(b.PrId),i.getSynchroDoc(b.PrId)})},isProjectSynchronized:function(b){if(!a.isActive())return"";var c=e.SynchroStatus.detailProjet[b];return void 0!=c&&1==c?"S":""},getListeProjets:function(){var b=a.get("listeProjets");return null!=b?b:null},getProjet:function(b,c){var d=a.get(b);if(null==d||void 0!=c&&1==c){var f=g.checkConnection();if(0==f.state)return h.log("Pas de connexion : getProjet"),e.demande_cnx.flag=!0,null;this.getSynchoDetailProjets(b),d=a.get(b)}return d},getFourniture:function(b,c){var d="F-"+b,f=a.get(d);if(null==f||void 0!=c&&1==c){var i=g.checkConnection();if(0==i.state)return h.log("Pas de connexion : getFourniture"),e.demande_cnx=!0,null;this.getSynchroFourniture(b),f=a.get(d)}return f},getDoc:function(b){var c="D-"+b,d=a.get(c);if(null==d){var f=g.checkConnection();if(0==f.state)return h.log("Pas de connexion : getDoc"),e.demande_cnx=!0,null;this.getSynchroDoc(b),d=a.get(c)}return d}};return i}]),angular.module("appliMobileBatiChiffrageApp").factory("ClientsFactory",["synchro","configSite","$http","$q","$rootScope","baPhoneGap","logs",function(a,b,c,d,e,f,g){var h={customerList:!1,getSynchoListeClients:function(a){var e=d.defer();g.log("J'APPELLE LE WS");var f="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_LISTE_GCLIENTS&UId="+b.profile.UId+"&type=CLIENT&order=ORDER+BY+nom+ASC%2C+dt_cre+DESC%2C+id+DESC&IDX";return c.post(f).success(function(a,b){h.customerList=a,e.resolve(h.customerList)}),e.promise},getSynchroClient:function(f){var g=d.defer(),h="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_GCLIENT&fonction=loadGClient&async=false&GCId="+f;c.post(h).success(function(a){g.resolve(a)}),a.set(f,{promise:g.promise,obj:{}}),g.promise.then(function(b){e.SynchroStatus.detailClient[f]=!0,a.set(f,{promise:g.promise,obj:b})})},getListeClients:function(){var b=a.get("listeClients");return null!=b?b:null},getClient:function(b,c){var d=a.get(b);if(null==d||void 0!=c&&1==c){var h=f.checkConnection();if(0==h.state)return g.log("Pas de connexion : getClient"),e.demande_cnx.flag=!0,null;this.getSynchroClient(b),d=a.get(b)}return d}};return h}]),angular.module("appliMobileBatiChiffrageApp").factory("LoginFactory",["synchro","configSite","$http","$q","$rootScope","logs",function(a,b,c,d,e,f){var g={getSynchoLogin:function(){return null},getNbAbo:function(c){return f.log("########### Liste des Abo",c[0]),f.log("########## count abo",c.length),0==c.length?(b.profile.hasAbo=!1,a.set("login",b.profile),!1):(b.profile.hasAbo=!0,a.set("login",b.profile),!0)},mustLog:function(){var a=0==b.profile.authentificated||0==b.profile.hasAbo;return a&&f.log("go Login"),a},setProfile:function(c){angular.forEach(c,function(a,c){b.profile[c]=a}),console.log(b.profile,"plopplop"),a.set("login",b.profile)}};return g}]),angular.module("appliMobileBatiChiffrageApp").factory("SettingsFactory",["synchro","logs",function(a,b){var c={getStockageQty:function(){return a.getStockageQty()}};return c}]),angular.module("appliMobileBatiChiffrageApp").factory("AppFactory",["$modal","logs",function(a,b){var c={alertCnxDemanded:function(a,d,e){b.log("CHECK : CHANFGE demande de CNX !!!!!!"),1==e.demande_cnx.flag&&(c.afficheDemandeCnx(!0),e.demande_cnx.flag=!1)},afficheDemandeCnx:function(b){a.open({animation:!0,templateUrl:"template/modal/cnxDemand.html",backdrop:!0,windowClass:"modal",controller:["$scope","$modalInstance",function(a,c){a.cancel=function(){c.dismiss("cancel"),void 0!=b&&1==b&&window.history.back()}}]})}};return c}]),angular.module("appliMobileBatiChiffrageApp").filter("formatPrix",function(){return function(a){return(Math.round(100*a)/100).toFixed(2).replace(".",",")}}).filter("NettoyagePhoneNumber",function(){return function(a){if("undefined"!=typeof a){var b=new RegExp("[-._/*() ]","g");return a=a.replace(b,"")}}}).filter("formatPhoneNumber",function(){return function(a){if("undefined"!=typeof a){if("+"==a.substr(0,1))return a;if("00"==a.substr(0,2))return a.replace(a.substr(0,2),"+");if("0"==a.substr(0,1))return a.replace(a.substr(0,1),"+33")}}}).filter("AffPhoneNumber",function(){return function(a){if("undefined"!=typeof a){if("+33"==a.substr(0,3)){a=a.replace(a.substr(0,3),"0");var b=a.match(/.{2}/g);a=b.join(" ")}else{var b=a.match(/.{2}/g);a=b.join(" ")}return a}}}).filter("tauxtva",function(){return function(a){var b=100*(a-1);return(Math.round(100*b)/100).toFixed(2).replace(".",",")}}).filter("formatNumber2chiffres",function(){return function(a){return(Math.round(100*a)/100).toFixed(2).replace(".",",")}}).filter("replacePointParVirgule",function(){return function(a){return String(a).replace(".",",")}}).filter("formatDatemdY",function(){return function(a){var b=String(a).split(" "),c=b[0].split("-");return c[2]+"/"+c[1]+"/"+c[0]}}).filter("html",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("trustUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).filter("cleanUrl",function(){return function(a){return String(a).replace("../","")}}),angular.module("appliMobileBatiChiffrageApp").directive("loader",function(){return{template:'<div ng-show="loader.loading"><img src="images/loading.gif" style="width: 100px; height: 100px;" class="center-block mg-t-15"></div>'}}),angular.module("appliMobileBatiChiffrageApp").controller("MainCtrl",["$scope","$rootScope","$http","$location","ProjetsFactory","ClientsFactory","configSite","LoginFactory","logs",function(a,b,c,d,e,f,g,h,i){if(a.projets=!1,a.clients=!1,a.GCId=!1,h.mustLog())g.msgError=!1,d.path("login");else{var j=e.getListeProjets();i.log("MAIN : ",j),null!=j&&j.then(function(b){a.projets=b;var c=b.length;c>5?a.countProj=5:a.countProj=c});var k=f.getListeClients();null!=k&&k.then(function(b){a.clients=b.liste;var c=b.liste.length;c>5?a.countClient=5:a.countClient=c});var l=window.location.hash.split("/")[1],m=l.substring(l.length-1,l.length);"s"!=m&&(l+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+l).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("AboutCtrl",["$scope","configSite","logs",function(a,b,c){a.count=0,a.clcl=function(){a.count++,a.count>7&&c.activate()};var d=window.location.hash.split("/")[1],e=d.substring(d.length-1,d.length);"s"!=e&&(d+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+d).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("ProfilCtrl",["$scope","LoginFactory","configSite","$location","$http",function(a,b,c,d,e){if(b.mustLog())c.msgError=!1,d.path("login");else{a.formProfil={societe:c.profile.societe,prenom:c.profile.prenom,nom:c.profile.nom,cnaf2:c.profile.cnaf2,login:c.profile.login,loginConfirm:c.profile.login,password:c.profile.password,passwordConfirm:c.profile.password,telephone:c.profile.telephone,fax:c.profile.fax,email_contact:c.profile.email_contact,adresse:c.profile.adresse,cp:c.profile.cp,ville:c.profile.ville,pays:c.profile.pays};var f={mode:"GET_LISTE_PAYS"},g="http://"+c.UrlBC+"/scripts/interface.php";e({url:g,method:"GET",params:f}).success(function(b,c){a.Tpays=b})["finally"](function(){a.loader={loading:!1}});var h={mode:"GET_LISTE_ACTIVITE"};e({url:g,method:"GET",params:h}).success(function(b,c){a.TActivite=b})["finally"](function(){a.loader={loading:!1}})}var i=window.location.hash.split("/")[1],j=i.substring(i.length-1,i.length);"s"!=j&&(i+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+i).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("ContactCtrl",["$scope","ProjetsFactory","logs",function(a,b,c){c.log(localStorage);var d=window.location.hash.split("/")[1],e=d.substring(d.length-1,d.length);"s"!=e&&(d+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+d).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("ProjetCtrl",["$scope","$rootScope","$http","$location","$routeParams","$route","ProjetsFactory","configSite","LoginFactory","AppFactory","logs",function(a,b,c,d,e,f,g,h,i,j,k){a["synchronized"]=!1;var l=function(b){null!=b&&b.then(function(b){if(null!=b&&0!==Object.keys(b).length){a.projet=b,a.lignes=b.TLigne,a.tvas=b.TListeTVA;var c=0;angular.forEach(b.TListeTVA,function(a,b){c+=parseFloat(a.total)}),a.sum=Math.round(100*c)/100,a["synchronized"]=!0}})},m=function(b){null!=b&&b.then(function(b){a.doc=b})};if(a.syncrho_projet=function(){k.log("syncrho_projet + DOC"),l(g.getProjet(e.PrId,!0)),f.reload()},i.mustLog())h.msgError=!1,d.path("login");else{a.$watch(a.demande_cnx.flag,j.alertCnxDemanded),a.oneAtATime=!0,a.status={isFirstOpen:!1,isFirstDisabled:!1};var n=g.getProjet(e.PrId);l(n);var o=g.getDoc(e.PrId);m(o),a.testLibelle=function(a){return"<NULL>"!=a};var p=window.location.hash.split("/")[1],q=p.substring(p.length-1,p.length);"s"!=q&&(p+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+p).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ProjetsCtrl",["$scope","ProjetsFactory","$http","$location","configSite","LoginFactory","logs",function(a,b,c,d,e,f,g){if(a.projets={},a.ProjetsFactory=b,f.mustLog())e.msgError=!1,d.path("login");else{var h=b.getListeProjets();if(null!=h){h.then(function(b){a.projets=b})}var i=a.projets.length-1;i>5?a.countProj=5:a.countProj=i;var j=window.location.hash.split("/")[1],k=j.substring(j.length-1,j.length);"s"!=k&&(j+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+j).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("FournituresCtrl",["$scope","$http","$location","$routeParams","configSite","ProjetsFactory","LoginFactory","AppFactory","logs",function(a,b,c,d,e,f,g,h,i){if(g.mustLog())e.msgError=!1,c.path("login");else{a.$watch(a.demande_cnx.flag,h.alertCnxDemanded);var j=f.getFourniture(d.PrId);null!=j&&j.then(function(b){a.fournitures=b});var k=f.getProjet(d.PrId);null!=k&&k.then(function(b){a.projet=b})}}]),angular.module("appliMobileBatiChiffrageApp").controller("ParamprojetCtrl",["$scope","$location","$routeParams","configSite","ProjetsFactory","LoginFactory","logs",function(a,b,c,d,e,f,g){if(f.mustLog())d.msgError=!1,b.path("login");else{var h=e.getProjet(c.PrId);null!=h&&h.then(function(b){a.projet=b,a.tvas=b.TTauxTVA}),a.calculRemFO=function(a){return a=100-(100*a-77)/.28,Math.round(100*a)/100},a.calculDiffCh=function(a){return a=100-(100*a-90)/.25,Math.round(100*a)/100}}}]),angular.module("appliMobileBatiChiffrageApp").controller("ClientCtrl",["$scope","$http","$location","$routeParams","configSite","ClientsFactory","LoginFactory","AppFactory","$route","logs",function(a,b,c,d,e,f,g,h,i,j){var k=function(b){null!=b&&b.then(function(b){a.client=b,a.client.adresseaff=b.adresse.split("\n").join("<br/>"),a.client.commentaireaff=b.commentaire.split("\n").join("<br/>"),a.projetsLies=b.TListe_projets_lies,a.countProjetLie=b.TListe_projets_lies.length})};if(a.syncrho_client=function(){j.log("syncrho_client"),k(f.getClient(d.GCId,!0)),i.reload()},g.mustLog())e.msgError=!1,c.path("login");else{a.$watch(a.demande_cnx.flag,h.alertCnxDemanded),a.GCId=d.GCId;var l=f.getClient(d.GCId);k(l);var m=window.location.hash.split("/")[1],n=m.substring(m.length-1,m.length);"s"!=n&&(m+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+m).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ClientsCtrl",["$scope","$rootScope","$http","$location","configSite","ClientsFactory","LoginFactory","logs",function(a,b,c,d,e,f,g,h){if(g.mustLog())e.msgError=!1,d.path("login");else{var i=f.getListeClients();null!=i&&i.then(function(b){a.clients=b.liste});var j=window.location.hash.split("/")[1],k=j.substring(j.length-1,j.length);"s"!=k&&(j+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+j).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ChiffrageCtrl",["$scope","$location","logs",function(a,b,c){a.params=b.search();var d=window.location.hash.split("/")[1],e=d.substring(d.length-1,d.length);"s"!=e&&(d+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+d).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("LoginCtrl",["$scope","$location","$http","configSite","synchro","LoginFactory","AppFactory","baPhoneGap","logs",function(a,b,c,d,e,f,g,h,i){a.formLogin={},e.setConfig(d);var j=null;i.log("############ PATH ",b.path()),null!=(j=e.get("login"))&&j.then(function(a){if(1==a.hasAbo){if(""==a.UId)return;f.setProfile(a),b.path("main")}else b.path("code")}),a.formLogin.submitTheForm=function(j,k){var l=h.checkConnection();if(10==l.state)return void g.afficheDemandeCnx();var m={email:a.formLogin.email,password:a.formLogin.password},n="http://"+d.UrlBC+"/scripts/interface.php?mode=LOGIN&email="+m.email+"&pass="+m.password+"&cle_cryptage=&siret=&source=";c.post(n).success(function(a,c){'"KO"'!=a?(console.log(a,"blablabla"),f.setProfile({authentificated:!0,SId:a.user.SId,SId_mobile:a.user.SId_mobile,UId:a.UId,abonnement:a.user.abonnement,adresse:a.user.adresse,cp:a.user.cp,dt_cre:a.user.dt_cre,dt_maj:a.user.dt_maj,dt_finabo:a.user.dt_finabo,cp:a.user.cp,capital_user:a.user.capital_user,cnaf2:a.cnaf2,cnaf_user:a.user.cnaf_user,civ:a.user.civ,nom:a.user.nom,prenom:a.user.prenom,email_contact:a.user.email_contact,forme_juridique_user:a.user.forme_juridique_user,logo_client:a.user.logo_client,fax:a.user.fax,pays:a.user.pays,profession:a.user.profession,rcs_rm_user:a.user.rcs_rm_user,siren_user:a.user.siren_user,societe:a.user.societe,statut:a.user.statut,telephone:a.user.telephone,tva_intracomm_user:a.user.tva_intracomm_user,ville:a.user.ville,login:a.user.login,email:a.user.email,password:a.user.password}),0==f.getNbAbo(a.TAbonnement)?(i.log("########### REDIRECTION VERS LE CODE"),b.path("code")):(i.log("########### REDIRECTION VERS LE MAIN"),e.init(d),e.set("login",d.profile),b.path("main"))):(d.msgError=!0,b.path("login"))})},a.logout=function(){d.profile.authentificated=!1,d.profile.UId="",d.msgError=!1,e.clearAll(),b.path("login")}}]),angular.module("appliMobileBatiChiffrageApp").controller("LogOutCtrl",["$scope","$location","configSite","synchro","logs",function(a,b,c,d,e){c.profile.authentificated=!1,c.profile.UId="",c.msgError=!1,d.clearAll(),b.path("login")}]),angular.module("appliMobileBatiChiffrageApp").controller("SettingsCtrl",["$scope","SettingsFactory","baPhoneGap","logs",function(a,b,c,d){a.stockage=b.getStockageQty(),a.connexion=c.checkConnection()}]),angular.module("appliMobileBatiChiffrageApp").controller("ModalPassOublieCtrl",["$scope","$modal","logs",function(a,b,c){a.animationsEnabled=!0,a.formPassOublie={email:""},a.open=function(){b.open({animation:a.animationsEnabled,templateUrl:"template/modal/ModalPassOublie.html",backdrop:!0,windowClass:"modal",controller:["$scope","$modalInstance","$log","formPassOublie","configSite","$http",function(a,b,c,d,e,f){a.formPassOublie=d,a.msgpw={"class":"",message:""},a.submitPassOublie=function(){var b={email:a.formPassOublie.email};a.msgpw={"class":"",message:""};var c="http://"+e.UrlBC+"/scripts/interface.php?mode=CHECK_EMAIL&email="+b.email;f.post(c).success(function(c,d){if('"!EXIST"'==c)a.msgpw={"class":"alert-danger",message:"L'adresse email saisie n'est pas enregistrée !"};else{var g="http://"+e.UrlBC+"/scripts/interface.php?mode=FORGOT_PASS&email="+b.email;f.post(g).success(function(c,d){'"OK"'==c&&(a.msgpw={"class":"alert-success",message:"Vos identifiants ont bien été envoyés à l'adresse mail\r\n"+b.email
})})}})},a.cancel=function(){b.dismiss("cancel")}}],resolve:{formPassOublie:function(){return a.formPassOublie}}})},a.toggleAnimation=function(){a.animationsEnabled=!a.animationsEnabled}}]),angular.module("appliMobileBatiChiffrageApp").controller("ModalTest24Ctrl",["$scope","$modal","logs",function(a,b,c){a.animationsEnabled=!0,a.formTest={societe:"",nom:"",prenom:"",email:"",tel:""},a.open=function(){b.open({animation:a.animationsEnabled,templateUrl:"template/modal/Modal24h.html",backdrop:!0,windowClass:"modal",controller:["$scope","$modalInstance","$log","formTest","configSite","$http","$location","LoginFactory","$timeout",function(a,b,d,e,f,g,h,i,j){a.formTest=e,a.msgtest={"class":"",message:""},a.submitTest=function(){a.msgtest={"class":"",message:""};var d={mode:"CHECK_EMAIL",email:a.formTest.email},e="http://"+f.UrlBC+"/scripts/interface.php";g({url:e,method:"GET",params:d}).success(function(d,e){if('"EXIST"'==d)a.msgtest={"class":"alert-danger",message:"L'adresse email saisie est déjà enregistrée !"};else{var k={mode:"SAVE_PROSPECT",source:"Mobile",nom:a.formTest.societe,email:a.formTest.email,tel1:a.formTest.tel,MYTLV_nomcontact:a.formTest.nom,MYTLV_prenomcontact:a.formTest.prenom},l="http://"+f.UrlBC+"/scripts/interface.php";g({url:l,method:"GET",params:k}).success(function(d,e){c.log("########### DATA CREATION PROSPECT",d),d.id>0?(i.setProfile({authentificated:!0,UId:d.UId,nom:d.user.nom,prenom:d.user.prenom,abonnement:d.user.abonnement}),0==i.getNbAbo(d.TAbonnement)?(c.log("########### REDIRECTION VERS LE CODE"),a.msgtest={"class":"alert-success",message:"Votre code d'accès vient de vous être envoyé par SMS au "+d.tel1+" et par mail à "+d.email},j(function(){b.dismiss("cancel"),h.path("code")},4e3)):(c.log("########### REDIRECTION VERS LE MAIN"),b.dismiss("cancel"),h.path("main"))):a.msgtest={"class":"alert-danger",message:"Une erreur est survenue lors de la création de votre compte"}})}})},a.cancel=function(){b.dismiss("cancel"),h.path("login")}}],resolve:{formTest:function(){return a.formTest}}})},a.toggleAnimation=function(){a.animationsEnabled=!a.animationsEnabled}}]),angular.module("appliMobileBatiChiffrageApp").controller("CodeCtrl",["$scope","$location","configSite","synchro","$http","LoginFactory","logs",function(a,b,c,d,e,f,g){a.formCode={code:""},a.msgcode={"class":"",message:""},a.submitCode=function(){a.msgcode={"class":"",message:""},g.log("########### SUBMIT CODE");var d={code:a.formCode.code},h="http://"+c.UrlBC+"/scripts/interface.php?mode=CHECK_CODE_MOBILE&code="+d.code+"&UId="+c.profile.UId;e.post(h).success(function(c,d){g.log("################ USER : ",c),f.getNbAbo(c.TAbonnement)?b.path("main"):a.msgcode={"class":"alert-danger",message:"Mauvais erroné"}})}}]),angular.module("appliMobileBatiChiffrageApp").controller("EditionsCtrl",["$scope","ProjetsFactory","$http","$location","configSite","LoginFactory","$routeParams","logs",function(a,b,c,d,e,f,g,h){a.document={};var i="http://"+e.UrlBC+"/scripts/interfaceEL.php?mode=GET_DOCUMENT_DEVIS&UId="+e.profile.UId+"&PrId="+g.PrId;c.post(i).success(function(b,c){a.document=b})}]),angular.module("appliMobileBatiChiffrageApp").controller("DeviceCtrl",["$scope","configSite","logs","baPhoneGap","$http",function(a,b,c,d,e){a.message="ok",a.msgSuccess=!1,a.getPhoto=function(a){void 0==a?(c.log("get photo"),alert("get photo")):alert(a),d.captureImageFromCamera()},a.getAudio=function(){d.captureAudio()},a.litAudio=function(a){c.log("Lit audio : idSon"),alert("Lecture son : "+a)},a.setDevice=function(){c.log("Passage en mode device"),a.config.is_device=!0},a.delMedia=function(d){if(void 0==d)c.log("error MedId son");else{a.loader={loading:!0};var f="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=SUPPRIMER_MEDIA&UId="+b.profile.UId+"&MedId="+d;e.post(f).success(function(b,c){a.result="OK"})["finally"](function(){a.loader={loading:!1}})}};var f=window.location.hash.split("/")[1],g=f.substring(f.length-1,f.length);"s"!=g&&(f+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+f).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("GestionClientCtrl",["$scope","$http","$location","$timeout","$routeParams","configSite","LoginFactory","ClientsFactory","logs",function(a,b,c,d,e,f,g,h,i){if(g.mustLog())f.msgError=!1,c.path("login");else{var j={mode:"GET_LISTE_PAYS"},k="http://"+f.UrlBC+"/scripts/interface.php";b({url:k,method:"GET",params:j}).success(function(b,c){a.Tpays=b}),a.formClient={},a.GCId=void 0!=e.GCId?a.GCId=e.GCId:"",a.title=""==a.GCId?"Création d'un nouveau client":"Modification d'un client";var l=h.getClient(a.GCId);null!=l&&l.then(function(b){a.formClient=b}),a.msg={"class":"",message:""},a.submitClient=function(){a.msg={"class":"",message:""};var e={mode:"MODIF_GCLIENT",called_function:"validateGClient()",civ:a.formClient.civ,societe:a.formClient.societe,nom:a.formClient.nom,prenom:a.formClient.prenom,adresse:a.formClient.adresse,cp:a.formClient.cp,ville:a.formClient.ville,pays:a.formClient.pays,email:a.formClient.email,tel_fixe:a.formClient.tel_fixe,tel_port:a.formClient.tel_port,fax:a.formClient.fax,commentaire:a.formClient.commentaire,origine:"ADP",UId:f.profile.UId,GCId:a.GCId},g="http://"+f.UrlBC+"/scripts/interfaceEL.php";b({url:g,method:"GET",params:e}).success(function(b,e){b.id>0&&""==a.GCId?(a.msg={"class":"alert-success",message:"Ce client a bien été ajouté"},d(function(){c.path("client/"+b.GCId)},1e3)):b.id>0&&""!=a.GCId?(a.msg={"class":"alert-success",message:"Ce client a bien été modifié"},d(function(){c.path("client/"+b.GCId)},1e3)):a.msg={"class":"alert-danger",message:"Une erreur est survenue lors de l'enregistrement de votre client"}})}}}]),angular.module("appliMobileBatiChiffrageApp").controller("PhotosCtrl",["$scope","$http","$location","$timeout","$routeParams","configSite","LoginFactory","ClientsFactory",function(a,b,c,d,e,f,g,h){if(g.mustLog())f.msgError=!1,c.path("login");else{a.loader={loading:!0},a.show=!0,a.PrId=void 0!=e.PrId?e.PrId:"NONE",a.photos={},a.site=f.UrlBC;var i="http://"+f.UrlBC+"/scripts/interfaceEL.php?mode=LIST_MEDIA&UId="+f.profile.UId+"&order=ORDER+BY+dt_maj+DESC%2Cdt_cre+DESC%2Cid+DESC&filtre_mask_etat=&PrId="+a.PrId+"&type=IMAGE";b.post(i).success(function(b,c){a.photos=b,a.nbphotos=b.length})["finally"](function(){a.loader={loading:!1}})}}]),angular.module("appliMobileBatiChiffrageApp").controller("SonsCtrl",["$scope","$location","$routeParams","configSite","LoginFactory","$http",function(a,b,c,d,e,f){if(e.mustLog())d.msgError=!1,b.path("login");else{a.loader={loading:!0},a.show=!0,a.PrId=void 0!=c.PrId?c.PrId:"NONE",a.sons={},a.site=d.UrlBC;var g="http://"+d.UrlBC+"/scripts/interfaceEL.php?mode=LIST_MEDIA&UId="+d.profile.UId+"&order=ORDER+BY+dt_maj+DESC%2Cdt_cre+DESC%2Cid+DESC&filtre_mask_etat=&PrId="+a.PrId+"&type=AUDIO";f.post(g).success(function(b){a.sons=b,a.nbsons=b.length})["finally"](function(){a.loader={loading:!1}})}}]),angular.module("appliMobileBatiChiffrageApp").controller("NotesCtrl",["$scope","LoginFactory","configSite","$location","$http","$routeParams",function(a,b,c,d,e,f){b.mustLog()?(c.msgError=!1,d.path("login")):(a.PrId=void 0!=f.PrId?f.PrId:"",a.notes={});var g=window.location.hash.split("/")[1],h=g.substring(g.length-1,g.length);"s"!=h&&(g+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+g).addClass("active")}]);