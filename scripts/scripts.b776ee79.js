angular.module("webStorage",["logs"]).factory("webStorage",["logs",function(a){var b={set:function(a,b){localStorage.setItem(a,JSON.stringify(b))},get:function(a){var b=localStorage.getItem(a);if(void 0==b||null==b)return null;var c=null;try{c=JSON.parse(b)}catch(d){}return c},clearAll:function(){console.log("CLEAR LOCALSTORAGE"),localStorage.clear()},getQty:function(){var a=0;return angular.forEach(localStorage,function(b){a+=b.length}),a}};return b}]),angular.module("synchro",["webStorage","logs"]).factory("synchro",["webStorage","$q","logs",function(a,b,c){var d={listeSynchro:[],dateSynchro:0,config:null,setConfig:function(a){this.config=a},isStorageEnable:function(){return this.isActive()&&1==this.config.synchro.storageEnable&&"string"==typeof this.config.synchro.storageType},init:function(a){console.log("INIT ! ");var b=this;b.config=a,b.isActive()&&angular.forEach(a.synchro.links,function(a){var c=null;if(void 0!=a.checkIfSync&&1==a.checkIfSync&&(c=b.get(a.name)),null==c){var d=a.callback(a);b.listeSynchro[a.name]=d,b.isStorageEnable()&&void 0!=d&&(void 0==a.specificStorage||1!=a.specificStorage)&&(b.storageSet(a.name,d,!0),void 0!=a.setTimeSynchro&&0!=a.setTimeSynchro&&(b.dateSynchro=Date.now()/1e3|0,b.timeSynchro=a.setTimeSynchro))}})},storageSet:function(b,c,d){"undefined"==typeof d&&(d=!0);var e=this;switch(this.config.synchro.storageType){case"W":console.log("Stockage clÃ© : ",d,b,c),d?c.then(function(c){a.set(b,c)}):a.set(b,c);break;case"P":console.log("Storage PHONE",e.config.synchro)}},storageGet:function(b){var c=this;switch(c.config.synchro.storageType){case"W":return a.get(b);case"P":console.log("Storage PHONE",c.config.synchro)}},storageClearAll:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.clearAll();case"P":console.log("ClearAll PHONE",b.config.synchro)}},storageQty:function(){var b=this;switch(b.config.synchro.storageType){case"W":return a.getQty();case"P":console.log("getQTY PHONE",b.config.synchro)}},isActive:function(){return null==this.config||"undefined"==typeof this.config.synchro||"undefined"==typeof this.config.synchro.enabled||1!=this.config.synchro.enabled||"undefined"==typeof this.config.synchro.links||0==this.config.synchro.links.length?!1:!0},getConf:function(a){if(this.isStorageEnable()){var b=this.storageGet("conf_"+a);return b}},get:function(a,b){var c=this;if(console.log(a+" --------------------------> "+b+" ------++++> ",c.listeSynchro[a]),"undefined"!=typeof c.listeSynchro[a]&&null!=c.listeSynchro[a])return c.listeSynchro[a];if(c.isStorageEnable()){var d=c.storageGet(a);if("undefined"!=typeof d&&null!=d){void 0!=b&&void 0!=d[b]&&(d=d[b].obj);var e=c.getPromise(d);return c.listeSynchro[a]=e,e}}return null},getPromise:function(a){var c=b.defer();return c.resolve(a),c.promise},setConf:function(a,b){if(this.isStorageEnable()){this.storageSet("conf_"+a,b,!1)}},set:function(a,b,c){var d,e;if(void 0!=c){void 0==c.promise?(d=this.getPromise(c),e=c):(d=c.promise,e=c.obj),void 0==this.listeSynchro[a]&&(this.listeSynchro[a]=[]),this.listeSynchro[a][b]=d;var f=this.storageGet(a);null==f&&(f=[]),void 0==f&&(f=[]),f[b]=e,this.storageSet(a,f,!1)}else void 0==b.promise?(d=this.getPromise(b),e=b):(d=b.promise,e=b.obj),this.listeSynchro[a]=d,this.storageSet(a,e,!1)},clearAll:function(){this.storageClearAll(),this.listeSynchro=[]},checkTimeout:function(){return 0!=this.dateSynchro&&0!=this.timeSynchro?(c.info("Message !!!!"),(Date.now()/100|0)-this.dateSynchro>this.timeSynchro):!1},getStockageQty:function(){var a={stockage:0,memoire:0,espaceNote:0};return console.log("dfdfdfdfdfdfffffffffffffffffffffffffffffffffffffffffffffffffffff",a),a.stockage=this.storageQty(),console.log("dfdfdfdfdfdfffffffffffffffffffffffffffffffffffffffffffffffffffff",a),a}};return d}]),angular.module("logs",["ngRoute"]).config(["$routeProvider",function(a){console.log("Add logs route"),a.when("/logs",{templateUrl:"views/logs.html",controller:"LogsCtrl"})}]).controller("LogsCtrl",["$scope","logs",function(a,b){a.logs=b}]).factory("logs",["$rootScope",function(a){var b={active:!1,logList:[],activate:function(){console.log("Logs activated"),this.active=!0},unactivate:function(){this.active=!1,console.log("Logs non activated")},log:function(a,b){if(this.active){var c=Date.now()/1e3|0;this.logList.push({date:c,type:a,message:b})}},error:function(a){this.log("ERROR",a)},info:function(a){this.log("INFO",a)},warning:function(a){this.log("WARN",a)}};return b}]),angular.module("appliMobileBatiChiffrageApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","angular.filter","synchro","logs"]).value("configSite",{profile:{authentificated:!1,UId:""},msgError:!1,synchro:{enabled:!0,links:[],storageEnable:!0,storageType:"W"},UrlBC:"chiffrage.batiactu.com"}).run(["$rootScope","configSite","ProjetsFactory","ClientsFactory","LoginFactory","synchro","logs",function(a,b,c,d,e,f,g){a.filter={},a.config=b,a.SynchroStatus={listeProjets:!1,detailProjet:[],listeClients:!1},b.synchro.links.push({name:"listeProjets",callback:c.getSynchoListeProjets,checkIfSync:!0,setTimeSynchro:1e3}),b.synchro.links.push({name:"listeDetailProjets",callback:c.getSynchoListeDetailProjets,specificStorage:!0}),b.synchro.links.push({name:"listeClients",callback:d.getSynchoListeClients}),f.setConfig(b),f.getStockageQty(),console.log("ppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp"),g.activate(),g.info("INIT LOGS")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/myroute",{templateUrl:"views/myroute.html",controller:"MyrouteCtrl"}).when("/projet/:PrId",{templateUrl:"views/projet.html",controller:"ProjetCtrl"}).when("/projets",{templateUrl:"views/projets.html",controller:"ProjetsCtrl"}).when("/fournitures/:PrId",{templateUrl:"views/fournitures.html",controller:"FournituresCtrl"}).when("/paramprojet/:PrId",{templateUrl:"views/paramprojet.html",controller:"ParamprojetCtrl"}).when("/clients",{templateUrl:"views/clients.html",controller:"ClientsCtrl"}).when("/client/:GCId",{templateUrl:"views/client.html",controller:"ClientCtrl"}).when("/chiffrage",{templateUrl:"views/chiffrage.html",controller:"ChiffrageCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogOutCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("appliMobileBatiChiffrageApp").factory("ProjetsFactory",["synchro","configSite","$http","$q","$rootScope",function(a,b,c,d,e){var f={projectList:!1,nbDetailToSynchronize:5,getSynchoListeProjets:function(a){var e=d.defer(),g="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJETS_FAVORIS_CLIENT&UId="+b.profile.UId+"&order=ORDER+BY+p.dt_maj+DESC%2Cp.dt_cre+DESC%2Cp.id+DESC&filtre_mask_etat=";return c.post(g).success(function(a,b){f.projectList=a,e.resolve(f.projectList)}),e.promise},getSynchoListeDetailProjets:function(g){var h=[],i=a.get("listeProjets");return null==i?null:void i.then(function(g){e.SynchroStatus.listeProjets=!0;var i=f.nbDetailToSynchronize;g.length<f.nbDetailToSynchronize&&(i=g.length);for(var j=0;i>j;j++){{var k=a.get(g[j].PrId);Date.now()/1e3|0}if(null==k){h[g[j].PrId]=d.defer();var l="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJET&fonction=loadProjet&async=false&PrId="+g[j].PrId;c.post(l).success(function(a,b){h[a.PrId].resolve(a)}),a.set(g[j].PrId,{promise:h[g[j].PrId].promise,obj:{}}),h[g[j].PrId].promise.then(function(b){e.SynchroStatus.detailProjet[b.PrId]=!0,a.set(b.PrId,{promise:h[b.PrId].promise,obj:b})})}}})},getSynchoDetailProjets:function(f){deferred=d.defer();var g="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJET&fonction=loadProjet&async=false&PrId="+f;c.post(g).success(function(a,b){deferred.resolve(a)}),a.set(f,{idObj:f,promise:deferred.promise,obj:{}}),deferred.promise.then(function(b){e.SynchroStatus.detailProjet[f]=!0;var c=a.get(f);c.obj=b})},isProjectSynchronized:function(b){if(!a.isActive())return"";var c=e.SynchroStatus.detailProjet[b];return void 0!=c&&1==c?"S":""},getListeProjets:function(){var b=a.get("listeProjets");return null!=b?b:null},getProjet:function(b){var c=a.get(b);return null==c&&(this.getSynchoDetailProjets(b),c=a.get(b)),c}};return f}]),angular.module("appliMobileBatiChiffrageApp").factory("ClientsFactory",["synchro","configSite","$http","$q","$rootScope",function(a,b,c,d,e){var f={customerList:!1,getSynchoListeClients:function(a){var e=d.defer();console.log("J'APPELLE LE WS");var g="http://"+b.UrlBC+"/scripts/interfaceEL.php?mode=GET_LISTE_GCLIENTS&UId="+b.profile.UId+"&type=CLIENT&order=ORDER+BY+nom+ASC%2C+dt_cre+DESC%2C+id+DESC&IDX";return c.post(g).success(function(a,b){f.customerList=a,e.resolve(f.customerList)}),e.promise},getListeClients:function(){var b=a.get("listeClients");return null!=b?b:null}};return f}]),angular.module("appliMobileBatiChiffrageApp").factory("LoginFactory",["synchro","configSite","$http","$q","$rootScope",function(a,b,c,d,e){var f={getSynchoLogin:function(){return null}};return f}]),angular.module("appliMobileBatiChiffrageApp").factory("SettingsFactory",["synchro",function(a){var b={getStockageQty:function(){return a.getStockageQty()}};return b}]),angular.module("appliMobileBatiChiffrageApp").filter("formatPrix",function(){return function(a){return(Math.round(100*a)/100).toFixed(2).replace(".",",")}}).filter("NettoyagePhoneNumber",function(){return function(a){if("undefined"!=typeof a){var b=new RegExp("[-._/*() ]","g");return a=a.replace(b,"")}}}).filter("formatPhoneNumber",function(){return function(a){if("undefined"!=typeof a){if("+"==a.substr(0,1))return a;if("00"==a.substr(0,2))return a.replace(a.substr(0,2),"+");if("0"==a.substr(0,1))return a.replace(a.substr(0,1),"+33")}}}).filter("AffPhoneNumber",function(){return function(a){if("undefined"!=typeof a){if("+33"==a.substr(0,3)){a=a.replace(a.substr(0,3),"0");var b=a.match(/.{2}/g);a=b.join("-")}return a}}}).filter("tauxtva",function(){return function(a){var b=100*(a-1);return(Math.round(100*b)/100).toFixed(2).replace(".",",")}}).filter("formatNumber2chiffres",function(){return function(a){return(Math.round(100*a)/100).toFixed(2).replace(".",",")}}).filter("replacePointParVirgule",function(){return function(a){return String(a).replace(".",",")}}).filter("formatDatemdY",function(){return function(a){var b=String(a).split(" "),c=b[0].split("-");return c[2]+"/"+c[1]+"/"+c[0]}}),angular.module("appliMobileBatiChiffrageApp").controller("MainCtrl",["$scope","$rootScope","$http","$location","ProjetsFactory","ClientsFactory","configSite",function(a,b,c,d,e,f,g){if(a.projets=!1,a.clients=!1,0==g.profile.authentificated)g.msgError=!1,d.path("login");else{var h=e.getListeProjets();console.log("MAIN : ",h),null!=h&&h.then(function(b){a.projets=b});var i=f.getListeClients();null!=i&&i.then(function(b){a.clients=b.liste;var c=b.liste.length;c>5?a.countClient=5:a.countClient=c});var j=window.location.hash.split("/")[1],k=j.substring(j.length-1,j.length);"s"!=k&&(j+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+j).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("AboutCtrl",["$scope","configSite","logs",function(a,b,c){a.count=0,a.clcl=function(){a.count++,a.count>7&&c.activate()};var d=window.location.hash.split("/")[1],e=d.substring(d.length-1,d.length);"s"!=e&&(d+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+d).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("ContactCtrl",["$scope","ProjetsFactory",function(a,b){console.log(localStorage);var c=window.location.hash.split("/")[1],d=c.substring(c.length-1,c.length);"s"!=d&&(c+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+c).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("ProjetCtrl",["$scope","$rootScope","$http","$location","$routeParams","ProjetsFactory","configSite",function(a,b,c,d,e,f,g){if(a["synchronized"]=!1,0==g.profile.authentificated)g.msgError=!1,d.path("login");else{a.oneAtATime=!0,a.status={isFirstOpen:!1,isFirstDisabled:!1};var h=f.getProjet(e.PrId);console.log("getProjet :",h),null!=h&&h.then(function(b){if(console.log("datas ----> ",Object.keys(b).length),null!=b&&0!==Object.keys(b).length){a.projet=b,a.lignes=b.TLigne,a.tvas=b.TListeTVA;var c=0;angular.forEach(b.TListeTVA,function(a,b){c+=parseFloat(a.total)}),a.sum=Math.round(100*c)/100,a["synchronized"]=!0}}),a.testLibelle=function(a){return"<NULL>"==a?!1:!0};var i=window.location.hash.split("/")[1],j=i.substring(i.length-1,i.length);"s"!=j&&(i+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+i).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ProjetsCtrl",["$scope","ProjetsFactory","$http","$location","configSite",function(a,b,c,d,e){if(a.projets={},a.ProjetsFactory=b,0==e.profile.authentificated)e.msgError=!1,d.path("login");else{var f=b.getListeProjets();if(null!=f){f.then(function(b){a.projets=b})}var g=a.projets.length-1;g>5?a.countProj=5:a.countProj=g;var h=window.location.hash.split("/")[1],i=h.substring(h.length-1,h.length);"s"!=i&&(h+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+h).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("FournituresCtrl",["$scope","$rootScope","$http","$location","$routeParams","configSite",function(a,b,c,d,e,f){if(0==f.authentificated)f.msgError=!1,d.path("login");else{var g="http://"+f.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJET&fonction=loadProjet&async=false&PrId="+e.PrId,h="http://"+f.UrlBC+"/scripts/interfaceEL.php?mode=GET_LISTE_COMPOS&PrId="+e.PrId;c.post(h).success(function(b,c){a.fournitures=b}),c.post(g).success(function(b,c){a.projet=b})}}]),angular.module("appliMobileBatiChiffrageApp").controller("ParamprojetCtrl",["$scope","$rootScope","$http","$location","$routeParams","configSite",function(a,b,c,d,e,f){if(0==f.profile.authentificated)f.msgError=!1,d.path("login");else{var g="http://"+f.UrlBC+"/scripts/interfaceEL.php?mode=GET_PROJET&fonction=loadProjet&async=false&PrId="+e.PrId;c.post(g).success(function(b,c){a.projet=b,a.tvas=b.TTauxTVA}),a.calculRemFO=function(a){return a=100-(100*a-77)/.28,Math.round(100*a)/100},a.calculDiffCh=function(a){return a=100-(100*a-90)/.25,Math.round(100*a)/100}}}]),angular.module("appliMobileBatiChiffrageApp").controller("ClientCtrl",["$scope","$http","$location","$routeParams","configSite",function(a,b,c,d,e){if(0==e.profile.authentificated)e.msgError=!1,c.path("login");else{var f="http://"+e.UrlBC+"/scripts/interfaceEL.php?mode=GET_GCLIENT&fonction=loadGClient&async=false&GCId="+d.GCId;b.post(f).success(function(b,c){a.client=b,a.projetsLies=b.TListe_projets_lies,a.countProjetLie=b.TListe_projets_lies.length});var g=window.location.hash.split("/")[1],h=g.substring(g.length-1,g.length);"s"!=h&&(g+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+g).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ClientsCtrl",["$scope","$rootScope","$http","$location","configSite","ClientsFactory",function(a,b,c,d,e,f){if(0==e.profile.authentificated)e.msgError=!1,d.path("login");else{var g=f.getListeClients();null!=g&&g.then(function(b){a.clients=b.liste});var h=window.location.hash.split("/")[1],i=h.substring(h.length-1,h.length);"s"!=i&&(h+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+h).addClass("active")}}]),angular.module("appliMobileBatiChiffrageApp").controller("ChiffrageCtrl",["$scope","$location","$log",function(a,b,c){a.params=b.search(),a.$log=c;var d=window.location.hash.split("/")[1],e=d.substring(d.length-1,d.length);"s"!=e&&(d+="s"),$("#navbar ul li").removeClass("active"),$("#navbar ul li#"+d).addClass("active")}]),angular.module("appliMobileBatiChiffrageApp").controller("LoginCtrl",["$scope","$location","$http","configSite","synchro",function(a,b,c,d,e){a.formLogin={},e.setConfig(d);var f=null;null!=(f=e.get("login"))&&f.then(function(a){""!=a.UId&&(d.profile.authentificated=a.authentificated,d.profile.UId=a.UId,e.init(d),b.path("main"))}),a.formLogin.submitTheForm=function(f,g){var h={email:a.formLogin.email,password:a.formLogin.password},i="http://"+d.UrlBC+"/scripts/interface.php?mode=LOGIN&email="+h.email+"&pass="+h.password+"&cle_cryptage=&siret=&source=";c.post(i).success(function(a,c){'"KO"'!=a?(d.profile.authentificated=!0,d.profile.UId=a.UId,e.init(d),e.set("login",d.profile),b.path("main")):(d.msgError=!0,b.path("login"))})},a.logout=function(){d.profile.authentificated=!1,d.profile.UId="",d.msgError=!1,e.clearAll(),b.path("login")}}]),angular.module("appliMobileBatiChiffrageApp").controller("LogOutCtrl",["$scope","$location","configSite","synchro",function(a,b,c,d){c.profile.authentificated=!1,c.profile.UId="",c.msgError=!1,d.clearAll(),b.path("login")}]),angular.module("appliMobileBatiChiffrageApp").controller("SettingsCtrl",["$scope","SettingsFactory",function(a,b){a.stockage=b.getStockageQty()}]);